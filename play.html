<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Coloretto</title>
<link rel="stylesheet" href="bootstrap-4.0.0-alpha.6-dist/css/bootstrap.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
<style>
	.container-fluid{
		background-image:url(wallpaper.png);
		height:800px;
	}
	.text-primary{
		color: black!important;
		font-size: 20px;
	}
	.welcome{
		padding-top:20px;
	}
	.play_zone{
		height: 120px;
		border: 1px rgba(13,90,12,1.00) solid;
		box-shadow: 1px 1px green;
		margin: 3px;
	}
	.common_cards_zone{
		height: auto;
		border: 1px rgba(13,90,12,1.00) solid;
		box-shadow: 1px 1px green;
		background-image: url(coloretto-zone.jpg);
	}
	
	.player{
		background-image:url(wallpaperblur.png);
	}
	.image_row{
		margin: 4px 3px 10px 3px;
		box-shadow: 1px 1px 2px black ;
	}
	#deck_zone{
		padding: 9px;
	}
	.image_cards_player{
		box-shadow: 1px 1px 2px black ;
		position: absolute;
	}
	.container_card{
		display: inline-block;
		margin:2px 10px 0px 2px;
		position: relative;
	}
	.number_of_cards{
		position: absolute;
		top: 85px;
		left: 46px;
		z-index: 1;
		height: 20px;
		background-color: white;
		color: black;
		font-weight: bold;
		width: 15px;
		text-align: center;
		padding-bottom: 20px;
	}

</style>
</head>

<body>
<script src="jquery-3.2.1.min.js"></script>
<script src="jquery-ui-1.12.1/jquery-ui.js"></script>

<div class="container-fluid" id="main_page">
</div>

<script>
var num_players = window.sessionStorage.getItem("num_players");
var rows= [];
var colores= ["bambu","clouds","fruits","orange","sunflower","violet","wood"];
class Deck{
	addCard(name){
		this.cards.push(name);
	}
	drawCard(){
		this.cards.pop;
	}
	shuffle(){
		var l = this.cards.length;
		var unchosen = this.cards.slice();
		for(var i=0; i<l;i++){
			var n = Math.floor(Math.random()*unchosen.length);
			this.cards[i] = unchosen[n];
			unchosen.splice(n,1);
		}
	}
}
var colorettoDeck = new Deck();
colorettoDeck.cards=[];

if(num_players<=3){
	var n = Math.floor(Math.random()*colores.length);
	colores.splice(n,1);
}

init()

var preselected = colores.slice();
var elected = [];
var players =[];
colores.push("as","plus2");
for(var j=0; j< num_players;j++){
	var dict = {};
	for(var c=0;c<colores.length;c++){
		dict[colores[c]] = 0;
	}
	players.push(dict);
	var n= Math.floor(Math.random()*preselected.length);
	addCard(j,preselected[n])
	elected.push(preselected[n]);
	preselected.splice(n,1);
}

prepareDeck();

function init(){
	var num_players = parseInt(window.sessionStorage.getItem("num_players"))
	var mainPage = document.getElementById("main_page");
	var bigRow = document.createElement("div");
	$(bigRow).addClass("row");
	var playersZone = document.createElement("div");
	var commonCardsZone = document.createElement("div");
	$(playersZone).addClass("col-md-8").attr("id","players_zone").attr("ng-controller","");
	$(commonCardsZone).addClass("col-md-4 common_cards_zone").css("height",123*num_players );
	mainPage.appendChild(bigRow);
	bigRow.appendChild(playersZone);
	bigRow.appendChild(commonCardsZone);		
	for(var i=0; i<num_players;i++ ){
		var row = document.createElement("div")
		$(row).addClass("row play_zone");
		playersZone.appendChild(row);
		var rowImage = document.createElement("img");
		$(rowImage).attr("src","rows.png").attr("height","110px").addClass("img-responsive image_row");
		var row = document.createElement("div");
		$(row).addClass("row");
		commonCardsZone.appendChild(row);
		row.appendChild(rowImage)
		}
	var row = document.createElement("div");
	$(row).addClass("row");
	$(row).html("<div class='col-md-8'> </div> <div class='col-md-4' id='deck_zone'> </div> ");
	mainPage.appendChild(row);
	var deckImage = document.createElement('img');
	$(deckImage).attr("src","cardBackRotatedjpg.jpg").addClass("img-responsive image_card_back");
	$('#deck_zone').append(deckImage);
	addCardImagesToRow(num_players);
	}

function addCardImagesToRow(num_players){
	for(var r=0;r<num_players;r++){
		for(var i=0;i<colores.length;i++){
			var container = document.createElement("div");
			$(container).addClass("container_card col-md-1");
			var number = document.createElement("p");
			$(number).attr("id","player_"+r+"_"+colores[i]).addClass("number_of_cards");
			container.appendChild(number);
			var img= document.createElement("img");
			$(img).attr("src","cards/"+colores[i]+".png").attr("height","110px").addClass("img-responsive image_cards_player");
			container.appendChild(img);
			document.getElementById("players_zone").children[r].appendChild(container);
		}
	}
}

function addCard(jugador,carta){
	players[jugador][carta]+=1
}
	
function updateCards(){
	for( var player =0; player < num_players; player++){
		for (var c =0; c< colores.length; c++){
			$("#player_"+player+"_"+colores[c]).html(players[player][colores[c]]);
		}
	}
}

function prepareDeck(){
	for (var c=0; c<colores.length-2;c++){
	if(elected.indexOf(colores[c]) >-1){
		for(var n=0; n<8;n++){
			colorettoDeck.addCard(colores[c][0])
		}
	}
	else{
		for(var n=0; n<9;n++){
			colorettoDeck.addCard(colores[c][0])
		}
	}
}
	for (var n=0;n<10;n++){
		colorettoDeck.addCard("2");
		}
	for(var n=0;n<3;n++){
		colorettoDeck.addCard("a");
		}
	for(var i=0;i<5;i++){
		colorettoDeck.shuffle()
		}
	colorettoDeck.cards.splice(15,0,"e");
	updateCards();
}
</script>
</body>
</html>
